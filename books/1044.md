# 变量

## 全局变量和局部变量

- 在C语言中，用户命名的标识符都有一个有效的作用域。
- 所谓标识符的“作用域”就是指程序中的某一部分，在这部分中，该标识符是有定义的，可以被C编译和连接程序所识别。
- 我们知道每个变量都有自己的作用域，在一个函数内定义的变量，不能在其他函数中引用。显然，变量的作用域与其定义语句在程序中出现的位置有直接的关系，据此变量可以划分为局部变量和全局变量。
- 注意“定义”和 “说明”两个词的区别。“定义”是指给变量分配确定的存储单元；“说明”只是说明变量的性质。
- （一）局部变量
  - 在一个函数内部定义的变量，它们只在本函数范围内有效，即只有本函数才能使用它们，其他函数不能使用这些变量，我们将这些变量称为“局部变量”。不同函数中可以使用相同名字的局部变量，它们代表不同的对象，在内存中占不同的单元，互不干扰。
- （二）全局变量
  - 在函数之外定义的变量称为外部变量，外部变量是全局变量。全局变量可以为本文件中其他函数所共用，它的有效范围从定义变量开始到本文件结束。
  - 如果在同一个源文件中，外部变量与局部变量同名，则在局部变量的作用范围内，外部变量被“屏蔽”，即它不起作用。
- 变量作用域和生存期
  - 生存期:什么时候这个变量开始出现了，到什么时候消亡了，变量值存在的时间(即生存期)
  - 作用域: 在(代码的) 什么范围内可以访问这个变量(这个变量可以起作用)
  - 对于本地变量，这两个问题的答案是统一的:大括号内一块





## 变量的存储类别

- 静态存储方式和动态存储方式。

  - 所谓静态存储方式是指在**程序运行期间** **分配固定的存储空间**的方式，而动态存储方式是在**程序运行期间** **根据需要动态分配存储空间**的方式
  - 在内存中供用户使用的空间可以分为程序区、静态存储区和动态存储区3个部分。数据分别被存放在静态存储区和动态存储区中。静态存储区中存放的是全局变量，在程序开始执行时就给全局变量分配存储区。程序执行过程中它们占据固定的存储单元，程序执行完毕这些存储单元就被释放。
  - 每一个变量和函数所具有的属性是：数据的存储类别和数据类型。所谓的存储类别指的是数据在内存中存储的方法，其可分为两类：静态存储类和动态存储类。具体包括自动(auto)、静态(static)、寄存器(register)和外部(extern)，共4种。

- （一）auto变量

  - 当在函数内部或复合语句内定义变量时，如果没有指定存储类别，或使用了auto说明符，系统就认为所定义的变量具有自动类别。如：
    - float a;等价于auto float a;
    - auto变量的存储单元被分配在内存的动态存储区，每当进入函数体(或复合语句)时，系统自动为auto变量分配存储单元，退出时自动释放这些存储单元另做他用。因此，这类局部变量的作用域是从定义的位置起，到函数体(或复合语句)结束止。
    - 所有自动类局部变量的存储单元都是在进入这些局部变量所在的函数体(或复合语句)时生成，退出其所在的函数体(或复合语句)时消失(变为无定义)。这就是自动类局部变量的“生存期“。当再次进入函数体(或复合语句)时，系统将为它们另行分配存储单元，因此变量的值不可能被保留。随着函数的频繁调用，动态存储区内为某个变量分配的存储单元位置会随程序的运行而改变。

- （二）register变量

  - 寄存器变量也是自动类变量。它与auto变量的区别仅在于：用register说明变量是建议编译程序将变量的值保留在CPU的寄存器中，而不是像一般变量那样占用内存单元。程序运行时，访问寄存器内的值要比访问内存中的值快得多。因此，当程序对运行速度有较高要求时，把那些频繁引用的少数变量，指定为register变量，有助于提高程序运行的效率。
    - 说明：
      - (1)CPU中寄存器的数目是有限的，因此只能说明少量的寄存器变量。在同一个函数中，允许说明为寄存器变量的数目不仅取决于CPU的类型，也与所用的C编译程序有关。当没有足够的寄存器来存放指定的变量，或编译程序认为指定的变量不适合放在寄存器中时，将自动按auto变量来处理。因此，register说明只是对编译程序的一种建议，而不是强制性的。
      - (2)由于register变量的值存放在寄存器内而不是存放在内存中，所以register变量没有地址，也就不能对它实行求地址运算。
      - (3)register变量的说明应尽量靠近其使用的地方，用完之后尽快释放，以便提高寄存器的利用效率。

- （三）static变量

  - 静态存储类别的局部变量，当函数体(或复合语句)内部用static来说明一个变量时，可以称该变量为静态局部变量。它与auto变量、register变量的本质区别是：
    - (1)在整个程序运行期间，静态局部变量在内存中的静态存储区中占据着永久性的存储单元。即使退出函数后，下次再进入该函数时，静态局部变量仍使用原来的存储单元。由于不释放这些存储单元，这些存储单元中的值得以保留，因而可以继续使用存储单元中原来的值。由此可知，静态局部变量的生存期将一直延长到程序运行结束。
    - (2)静态局部变量的初值是在编译时赋予的，在程序执行期间不再赋以初值。对未赋值的局部变量，C语言编译程序自动给它赋初值为0。

  - 用static声明外部变量，有时在程序设计中希望某些外部变量只限于本文件使用，而不能被其他文件引用，这时可以在定义外部变量时加一个static声明。
    - 并不是对外部变量加上static才是静态存储而不加static的是动态存储。两种形式的外部变量都是静态存储方式，只是作用范围不同而已。

- （四）用extern声明外部变量

  - ①　在一个文件内声明外部变量
    - 当全局变量定义在后，引用它的函数在前时，应该在引用它的函数中用extern对此全局变量进行说明，以便通知编译程序，该变量是一个已在外部定义了的全局变量，已经分配了存储单元，不需要为它另开辟存储单元。这时其作用域从extern说明处起，延伸到该函数末尾。
    - 全局变量的说明与全局变量的定义不同。变量的定义(开辟存储单元)只能出现一次，在定义全局变量时，不可使用extern说明符；而对全局变量的说明，则可以多次出现在需要的地方，这时必须用extern进行说明。
  - ②　在多文件的程序中声明外部变量
    - 当一个程序由多个单独编译的源文件组成，并且在每个文件中均需要引用同一个全局变量时，若在每个文件中都定义了所需的同名全局变量，则在“连接”时将会产生“重复定义”的错误。在这种情况下，单独编译每个文件时并无异常，编译程序将按定义分别给它们开辟存储空间，而当进行连接时，就会显示出错信息。解决的方法是：在其中一个文件中定义所有全局变量，而在其他用到这些全局变量的文件中用extern对这些变量进行说明。



